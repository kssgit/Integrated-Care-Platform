global:
  nameOverride: ""
  fullnameOverride: ""
  namespace: integrated-care

imagePullSecrets: []

serviceAccount:
  create: true
  name: ""
  annotations: {}
  automountServiceAccountToken: false

security:
  podSecurityContext:
    runAsNonRoot: true
    fsGroup: 10001
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    runAsNonRoot: true
    runAsUser: 10001
    runAsGroup: 10001
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL

networkPolicy:
  enabled: false
  allowSameNamespaceIngress: true
  allowDnsEgress: true
  egressAllowAll: true

scheduling:
  podAntiAffinity:
    enabled: true
    type: preferred
  topologySpread:
    enabled: true
    topologyKey: topology.kubernetes.io/zone
    maxSkew: 1
    whenUnsatisfiable: ScheduleAnyway

config:
  API_HOST: "0.0.0.0"
  API_PORT: "8000"
  API_CACHE_TTL_SECONDS: "30"
  API_EVENT_TOPIC: "api-events"
  API_EVENT_DLQ_TOPIC: "api-events-dlq"
  API_EVENT_PARKING_TOPIC: "api-events-parking"
  API_EVENT_CONSUMER_GROUP: "api-event-consumer"
  API_EVENT_CONSUMER_MAX_RETRIES: "3"
  API_EVENT_CONSUMER_BASE_DELAY_SECONDS: "0.1"
  API_EVENT_DEDUP_TTL_SECONDS: "3600"
  API_EVENT_DLQ_RETRY_GROUP: "api-event-dlq-retry"
  API_EVENT_DLQ_RETRY_MAX_ATTEMPTS: "3"
  API_EVENT_PARKING_MONITOR_GROUP: "api-event-parking-monitor"
  PARKING_ALERT_THRESHOLD: "10"
  PARKING_ALERT_WINDOW_SECONDS: "300"
  PARKING_ALERT_COOLDOWN_SECONDS: "300"
  PIPELINE_API_EVENT_PUBLISH_ENABLED: "false"
  PIPELINE_MONITORING_HOST: "0.0.0.0"
  PIPELINE_MONITORING_PORT: "8001"
  PIPELINE_STORE_BACKEND: "jsonl"
  PIPELINE_KAFKA_PUBLISH_ENABLED: "false"
  PIPELINE_PROVIDER_NAME: "seoul_open_data"
  PIPELINE_OUTPUT_FILE: "runtime/facilities.jsonl"
  PIPELINE_PAGE_SIZE: "200"
  PIPELINE_START_PAGE: "1"
  PIPELINE_END_PAGE: "1"

secret:
  create: true
  REDIS_URL: ""
  DATABASE_URL: ""
  KAFKA_BOOTSTRAP_SERVERS: ""
  PARKING_ALERT_WEBHOOK_URL: ""
  FACILITY_PROVIDER_BASE_URL: "https://provider.example.com"

api:
  enabled: true
  replicaCount: 2
  image:
    repository: ghcr.io/example/integrated-care-api
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 80
    targetPort: 8000
  resources:
    requests:
      cpu: "200m"
      memory: "256Mi"
    limits:
      cpu: "1"
      memory: "1Gi"
  hpa:
    enabled: true
    minReplicas: 2
    maxReplicas: 20
    averageCpuUtilization: 65
  pdb:
    enabled: true
    minAvailable: 1

apiEventConsumer:
  enabled: false
  replicaCount: 1
  image:
    repository: ghcr.io/example/integrated-care-api-event-consumer
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

apiEventDlqRetryWorker:
  enabled: false
  replicaCount: 1
  image:
    repository: ghcr.io/example/integrated-care-api-event-dlq-retry
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

apiEventParkingMonitorWorker:
  enabled: false
  replicaCount: 1
  image:
    repository: ghcr.io/example/integrated-care-api-event-parking-monitor
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

kafkaTopicProvisioner:
  enabled: true
  image:
    repository: bitnami/kafka
    tag: "3.9.0"
    pullPolicy: IfNotPresent
  topics:
    - name: etl-raw-events
      partitions: 3
      replicationFactor: 1
    - name: etl-normalized
      partitions: 3
      replicationFactor: 1
    - name: etl-errors
      partitions: 3
      replicationFactor: 1
    - name: api-events
      partitions: 3
      replicationFactor: 1
    - name: api-events-dlq
      partitions: 3
      replicationFactor: 1
    - name: api-events-parking
      partitions: 3
      replicationFactor: 1

pipelineMonitoring:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/example/integrated-care-pipeline-monitoring
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 80
    targetPort: 8001
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  pdb:
    enabled: false
    minAvailable: 1

etlCronJob:
  enabled: true
  schedule: "0 2 * * *"
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 3
  image:
    repository: ghcr.io/example/integrated-care-pipeline-etl
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: "150m"
      memory: "256Mi"
    limits:
      cpu: "1"
      memory: "1Gi"

serviceMonitor:
  enabled: true
  interval: 15s

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: integrated-care.local
      paths:
        - path: /
          pathType: Prefix
          serviceName: api
          servicePort: 80
  tls: []

dependencies:
  postgresql:
    enabled: false
  redis:
    enabled: true
  kafka:
    enabled: true
  kubePrometheusStack:
    enabled: false
  airflow:
    enabled: false

postgresql:
  auth:
    username: postgres
    password: postgres
    database: integrated_care
